plugins {
    id 'java'
    id 'org.jetbrains.intellij' version '1.17.2'
}

group = 'com.jdc.tools'
version = '1.0.0'

// è®¾ç½®ä¸“ä¸šçš„JARæ–‡ä»¶å
jar {
    archiveBaseName = 'jdc-precommit-review-intellij-plugin'
    archiveVersion = version
    archiveClassifier = ''
}

repositories {
    mavenCentral()
}

// Configure Gradle IntelliJ Plugin
intellij {
    version = '2023.3.8'
    type = 'IC' // Target IDE Platform

    plugins = ['com.intellij.java', 'Git4Idea']
}

dependencies {
    implementation 'com.fasterxml.jackson.core:jackson-core:2.15.2'
    implementation 'com.fasterxml.jackson.core:jackson-databind:2.15.2'
    implementation 'com.fasterxml.jackson.core:jackson-annotations:2.15.2'
    implementation 'org.apache.httpcomponents:httpclient:4.5.14'
    implementation 'org.apache.httpcomponents:httpcore:4.4.16'

    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.9.2'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.9.2'
}

// Set the JVM compatibility versions
tasks.withType(JavaCompile) {
    sourceCompatibility = "17"
    targetCompatibility = "17"
    options.encoding = 'UTF-8'
}

patchPluginXml {
    sinceBuild = '223'
    untilBuild = ''
    // ç§»é™¤untilBuildé™åˆ¶ï¼Œæ”¯æŒæ‰€æœ‰æœªæ¥ç‰ˆæœ¬

    changeNotes = """
    <h3>1.0.0</h3>
    <ul>
        <li>ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ</li>
        <li>ğŸ” æ™ºèƒ½AIä»£ç å®¡æŸ¥åŠŸèƒ½</li>
        <li>ğŸ“Š ä»£ç è´¨é‡è¯„åˆ†å’Œè¯¦ç»†åˆ†æ</li>
        <li>ğŸ”— Gitæš‚å­˜æ–‡ä»¶è‡ªåŠ¨æ£€æµ‹</li>
        <li>âš¡ å®æ—¶æµå¼è¾“å‡ºåˆ†æç»“æœ</li>
        <li>ğŸ›¡ï¸ å®‰å…¨çš„OAuth2æµè§ˆå™¨æˆæƒç™»å½•</li>
        <li>ğŸ¨ ç¬¦åˆIntelliJè®¾è®¡è§„èŒƒçš„ç°ä»£ç•Œé¢</li>
        <li>ğŸ“ æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€</li>
        <li>ğŸ“ˆ å®Œæ•´çš„å®¡æŸ¥å†å²è®°å½•</li>
        <li>ğŸš€ æ— ç‰ˆæœ¬ä¸Šé™ï¼Œæ”¯æŒæ‰€æœ‰æœªæ¥IntelliJç‰ˆæœ¬</li>
    </ul>
    """
}

test {
    useJUnitPlatform()
}

// é…ç½®æ’ä»¶åˆ†å‘åŒ…æ–‡ä»¶å
buildPlugin {
    archiveBaseName = 'JDC-PreCommit-Review-IntelliJ-Plugin'
    archiveVersion = version
    archiveClassifier = ''
}

// Configure Gradle IntelliJ Plugin
runIde {
    jvmArgs = ['-Xmx2048m']
}
